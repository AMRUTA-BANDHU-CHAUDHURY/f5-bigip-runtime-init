{
    "properties": {
        "runtime_parameters": {
            "title": "Runtime Parameters",
            "description": "Runtime parameters (used during future template rendering)",
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string"
                    },
                    "type": {
                        "type": "string",
                        "enum": ["static", "secret", "metadata"]
                    },
                    "secretProvider": {
                        "type": "object",
                        "properties": {
                            "type": {
                                "type": "string",
                                "enum": ["SecretsManager", "SecretManager", "default", "KeyVault"]
                            },
                            "environment": {
                                "type": "string",
                                "enum": ["gcp", "aws", "azure"]
                            },
                            "project": {
                                "description": "Name of the GCP Project",
                                "type": "string"
                            },
                            "region": {
                                "description": "Name of the AWS region used for secret storage",
                                "type": "string"
                            },
                            "vault": {
                                "description": "Name of the Azure Key Vault",
                                "type": "string"
                            }
                        },
                        "dependencies": {
                            "environment": {
                                "if": {
                                    "properties": {
                                        "environment": {
                                            "const": "gcp"
                                        }
                                    }
                                },
                                "then": {
                                    "required": [
                                        "project"
                                    ]
                                },
                                "if": {
                                    "properties": {
                                        "environment": {
                                            "const": "aws"
                                        }
                                    }
                                },
                                "then": {
                                    "required": [
                                        "region"
                                    ]
                                },
                                "if": {
                                    "properties": {
                                        "environment": {
                                            "const": "azure"
                                        }
                                    }
                                },
                                "then": {
                                    "required": [
                                        "vault"
                                    ]
                                }
                            }
                        },
                        "required": ["environment"]
                    },
                    "metadataProvider": {
                        "type": "object",
                        "properties": {
                            "environment": {
                                "type": "string",
                                "enum": ["gcp", "aws", "azure"]
                            },
                            "type": {
                                "type": "string",
                                "enum": ["network", "compute"]
                            }
                        },
                        "if": {
                            "properties": {
                                "type": {
                                    "const": "compute"
                                }
                            }
                        },
                        "then": {
                            "properties": {
                                "field": {
                                    "type": "string"
                                }
                            }
                        },
                        "if": {
                            "properties": {
                                "type": {
                                    "const": "network"
                                }
                            }
                        },
                        "then": {
                            "properties": {
                                "field": {
                                    "type": "string",
                                    "enum": ["ipv4", "ipv6"]
                                },
                                "index": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 8
                                }
                            },
                            "required": ["field", "index"]
                        },
                        "required": ["environment"]
                    },
                    "secretName": {
                        "title": "Secret Name",
                        "description": "Name of the secret in the secret manager of the specified cloud",
                        "type": "string"
                    }
                },
                "required": ["type"],
                "oneOf": [{
                    "type": "object",
                    "required": ["secretProvider"]
                }, {
                    "type": "object",
                    "required": ["metadataProvider"]
                }]
            }
        },
        "extension_packages": {
            "title": "Extension Packages",
            "description": "Used to specify packages to be installed on device",
            "type": "object",
            "properties": {
                "install_operations": {
                    "title": "Install Operations",
                    "description": "Specify the type and version of packages to install",
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "extensionType": {
                                "type": "string",
                                "enum": ["do", "as3", "ts", "cf"]
                            },
                            "extensionVersion": {
                                "type": "string"
                            },
                            "extensionHash": {
                                "type": "string"
                            }
                        },
                        "required": ["extensionType", "extensionVersion"]
                    }
                }
            },
            "required": ["install_operations"]
        },
        "extension_services": {
            "title": "Extension Services",
            "description": "Used to specify operations to be performed against specific services on device",
            "type": "object",
            "properties": {
                "service_operations": {
                    "title": "Service Operations",
                    "description": "Specify the operations to be performed against the specified services",
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "extensionType": {
                                "type": "string",
                                "enum": ["do", "as3", "ts", "cf"]
                            },
                            "type": {
                                "$comment": "The url can be local (file:) or remote (https: or http:) but the type remains 'url'",
                                "type": "string",
                                "enum": ["url"]
                            },
                            "value": {
                                "description": "URL of local or remote file containing the declarations to be applied",
                                "type": "string"
                            }
                        },
                        "required": []
                    }
                }
            },
            "required": ["service_operations"]
        },
        "host": {
            "title": "Host Parameters",
            "description": "Details of the local or remote device",
            "type": "object",
            "properties": {
                "address": {
                    "description": "URL or IP of the device",
                    "type": "string"
                },
                "port": {
                    "type": "integer"
                },
                "protocol": {
                    "type": "string",
                    "enum": ["http", "https"]
                },
                "username": {
                    "type": "string"
                },
                "password": {
                    "type": "string"
                }
            },
            "required": []
        }
    },
    "required": ["extension_packages", "extension_services"],
    "additionalProperties": false
}